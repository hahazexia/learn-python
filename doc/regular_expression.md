# 正则表达式

正则表达式（Regular Expression）是一种文本模式，用来匹配某个模式的字符串，是一种专门处理字符串的工具。

## 匹配字符

大多数情况下，普通字符只会匹配自己，例如正则表达式`'test'`将完全匹配字符串`test`。除了普通字符以外，正则表达式的语法中定义了一些元字符（metacharacters），它们不会匹配自己，而代表了特殊的含义。学习正则表达式主要就是学习使用这些元字符的功能。

下面是最常用的元字符列举：

```
 [ ] \ . ^ $ * + ? { } | ( )
```

* `[]`代表字符集合，它是你希望匹配的一组字符。可以单独列出字符，也可以使用`-`连接两个字符代表一系列字符。例如：

```python
import re
re1 = re.compile('[012]') # re1 匹配一个字符，它是0、1 或者 2
re2 = re.compile('[0-2]') # re2 和 re1 等价
re3 = re.compile('[a-zA-Z0-9]') # res 匹配所有英文字母和数字
```

⚠注意：如果将 元字符 写在字符集合中，那么元字符将失去特殊含义，变成普通的字符。

```python
import re
re1 = re.compile('[.]') # .是一个元字符，写在[]之中失去了特殊含义，只会去匹配一个普通的点

print(re1.search('1'))
# None
print(re1.search('.'))
# <re.Match object; span=(0, 1), match='.'>
```

如果在`[]`里`最前面`加上 `^` 符号，代表除了这个集合以外其他所有的字符，相当于`取反`的意思。

```python
import re
re3 = re.compile('[^0-9]') # 匹配所有非数字字符
```

注意，如果 `^` 不写在集合的首位，那么将失去`取反`的含义，就只表示匹配 `^` 这个字符。

```python
import re
re3 = re.compile('[0-9^]') # 匹配所有数字和 ^ 符号
```

* `\` 反斜杠，一些以 `\` 开头的特殊序列代表了一些预定义的字符集合。

```python
import re

re1 = re.compile('\d') # 匹配任何十进制数字；这等价于类 [0-9]
re2 = re.compile('\D') # 匹配任何非数字字符；这等价于类 [^0-9]
re3 = re.compile('\s') # 匹配任何空白字符；这等价于类 [ \t\n\r\f\v] 空格，\t横向制表符，\n换行符，\r回车符，\f换页符，\v纵向制表符
re4 = re.compile('\S') # 匹配任何非空白字符；这相当于类 [^ \t\n\r\f\v]
re5 = re.compile('\w') # 匹配任何字母与数字字符；这相当于类 [a-zA-Z0-9_]
re6 = re.compile('\W') # 匹配任何非字母与数字字符；这相当于类 [^a-zA-Z0-9_]
```

这些特殊的字符集合可以包含在`[]`中，例如：

```python
import re
re1 = re.compile('[\d,.]') # 匹配所有数字和逗号还有点 等价于 '[0-9,.]'
```

* `.` 点号，含义是匹配除了换行符之外的任何字符。python 中有一个 `re.DOTALL` 模式，如果开启了，则 `.` 点号将匹配任何字符，包括换行符。

* `^` 代表在字符串的开头匹配，`$` 代表在字符串的结尾匹配。python 中有一个`re.MULTILINE` 模式，如果开启了 `MULTILINE` 多行模式，那么 `^` 匹配字符串开始位置以及 `/n`换行符 或 `/r`回车符 之后的位置，而 `$` 匹配字符串结束位置以及 `/n`换行符 或 `/r`回车符 之前的位置。

例如：

```python
import re
re1 = re.compile('^1[345789]\d{9}$') # 匹配11位手机号码 从字符串开头匹配到结尾
```

### 量词

有几个元字符的含义是表示某个模式或字符需要重复多少次，这几个元字符就是量词。

* `*` 指定前一个字符匹配 `零次或多次`。 `x >= 0`
* `+` 指定前一个字符匹配 `一次或多次`。 `x >= 1`
* `?` 指定前一个字符匹配 `零次或一次`。 `x >= 0 并且 x <= 1`

```python
import re
re.compile('ca*t') # 匹配 ct 或者 cat 或者 caaaa...t
re.compile('ca+t') # 匹配 cat 或者 caaaa...t
re.compile('ca?t') # 匹配 ct 或者 cat
```

* `{m, n}` 其中 `m` 和 `n` 是十进制整数。 这个限定符意味着必须至少重复 `m` 次，最多重复 `n` 次。

```python
import re
re.compile('ca{0, 3}t') # 匹配 ct 或者 cat 或者 caat 或者 caaat
```

如果花括号 `{}` 里只写一个数字，那就代表重复固定的次数，例如 `{n}` 代表重复 `n` 次。

```python
import re
re.compile('ca{2}t') # 匹配 caat
```

⚠注意：当使用 `{m, n}` 这样的形式的时候，`m` 或者 `n` 可以省略，省略 `m` 被解释为 `0` 下限，而省略 `n` 则为无穷大的上限。因此我们就可以发现：

```python
# {0,} 与 * 相同， {1,} 相当于 + ， {0,1} 和 ? 相同
import re
re.compile('ca{0,}t')
re.compile('ca*t') # 它们俩等价

re.compile('ca{1,}t')
re.compile('ca+t') # 它们俩等价

re.compile('ca{0,1}t')
re.compile('ca?t') # 它们俩等价
```

如果是这种情况，建议直接使用 `* + ?` ，因为它们更简洁。

## 使用正则表达式

### 编译正则表达式

正则表达式被编译成`正则表达式对象`，`正则表达式对象`具有各种操作的方法。

```python
import re
re1 = re.compile('ca{2}t') # re1 变量存储的就是正则表达式 `ca{2}t` 对应的正则表达式对象
```

### 反斜杠灾难

正则表达式中使用 `\` 反斜杠代表特殊形式和 python 的字符串中的转义字符的使用互相冲突。

例如，如果你想匹配字符串 `'\'`，那么传递给re.compile的字符串必须是 `'\\'` ，因为反斜杠本身是元字符，必须在它前面再加一个反斜杠表示匹配它自身，而要将`'\\'`表示为 python 字符串，则要将反斜杠用转义字符表示，最终写成 `'\\\\'`。

简而言之，要匹配文字反斜杠，必须将 `'\\\\'` 写为正则字符串。解决方案是使用前缀为 `'r' `的字符串，这是 python 的原始字符串表示法。

```python
import re
re1 = re.compile(r'\\')
```

### 应用匹配

使用 `re.compile` 将正则表达式字符串编译成 `正则表达式对象`后，就可以调用`正则表达式对象`身上的各种方法了。也可以直接调用 `re` 模块上的各种方法。

```python
import re
re1 = re.compile('ca{2}t')

re1.match('caaat')
re1.search('caat')
re1.findall('caatcaat')
re1.finditer('caatcaat')
```



