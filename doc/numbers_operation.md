# 数值和运算

## 数值字面量

```python
1234, -24, 0, 9999999999999  #整数
1.23, 1., 3.14e-10, 4E210, 4.0e+210 # 浮点数
0o177, 0x9ff, 0b101010 # python 3.x 中的八进制 十六进制 二进制字面量
0177, 0o177, 0x9ff, 0b101010 # python 2.x 中的八进制 十六进制 二进制字面量
3+4j, 3.0+4.0j, 3J # 复数字面量
set('spam'), {1, 2, 3, 4} # 集合 2.x 和 3.x 中的构造形式
Decimal('1.0'), Fraction(1, 3) # 小数和分数扩展类型
bool(X), True, False # 布尔类型和字面量
```

* 如果编写一个带小数点或者幂的数字，那么python会将它创建为一个浮点数对象，将启用浮点数的运算法则。浮点数是双精度的。
* python 2.x 中有两种整型：一般整数（32位）和长整型（无限精度）。一个整数以`l` 或 `L`结尾可以强制转换成长整型，python也会自动转换长整型。python 3.x 中一般整型和长整型合二为一。
* 内置函数 `hex()`, `oct()`, `bin()` 把一个整数转换成三种进制（十六，八，二）的字符串。`int(str, base)` 根据每个给定的进制把一个字符串转换为一个整数。
* 复数是`实部 + 虚部`的写法，虚部以 `j` 或 `J` 结尾。复数也可以用内置函数 `complex(real, imag)` 创建。

## 表达式运算符

表达式的定义：数字或者其它对象与运算符相结合，并被python在执行时计算为一个值。

```python
yield x # 生成器函数 send 协议
lambda args: expression # 创建匿名函数
x if y else z # 三元选择表达式 （仅当y为真时，x才会被计算）
x or y # 逻辑或（仅当x为假时，y才会被计算）
x and y # 逻辑与（仅当x为真时，y才会被计算）
not x # 逻辑非
x in y, x not in y # 成员关系（可迭代对象，集合）
x is y, x is not y # 对象同一性测试
x < y, x <= y, x > y, x >= y # 大小比较，集合的子集和超集
x == y, x != y # 值等价性运算符
x | y # 按位或，集合并集
x ^ y # 按位异或，集合对称差集
x & y # 按位与，集合交集
x << y, x >> y # 将x左移或右移y位
x + y # 加法，拼接
x - y # 减法，集合差集
x * y # 乘法，重复
x % y # 求余数，格式化
x / y, x // y # 真除法，向下取整除法
-x, +x # 取负，取正
~x # 按位非（取反码）
x ** y # 幂运算（指数）
x[i] # 索引（序列，映射等）
x[i:j:k] # 分片
x(...) # 调用（函数，方法，类，其他可调用对象）
x.attr # 属性引用
(...) # 元组，表达式，生成器表达式
[...] # 列表，列表推导
{...} # 字典，集合，集合与字典推导
```

* python 2.x 中，值不相等可以写成 `x != y` 或 `x <> y`, python 3.x 中 `x <> y` 写法被移除。
* python 2.x 中，反引号表达式 ``x`` 和 `repr(x)` 作用相同，转换对象以显示字符串。python 3.x 移除了这个表达式。
* 比较运算符可以链式使用 `x < y < z` 和 `x < y and y < x` 相同

## 运算符优先级

* 在上一节的表格中，运算符从上到下优先级逐渐增高
* 同一行的表达式，通常从左到右组合（幂运算从右向左组合）
* 在圆括号中的表达式将获得更高的优先级，python 总会先行计算圆括号中的表达式
* 当使用不同的数值类型计算的时候，python首先将被操作的对象转换成其中最复杂的操作数的类型，然后再运算。整数比浮点数简单，浮点数比复数简单。

## 数字实际应用

* 当除法的两个操作数都是整数时，python 2.x `/` 会进行整数的除法， 而 python 3.x 会进行带小数的真除法。如果想在 python 3.x 进行整数的除法，请使用 `//` 向下取整除法运算符，而想在 python 2.x 中进行真除法，请修改操作数为小数，例如`4 / 2.0`

### 除法（经典除法 向下取整除法 真除法）

* `x / y`

经典除法和真除法。python 2.x 中，这个操作对于整数会省略小数部分，对于浮点数保留小数。python 3.x 中，变成真除法，无论任何类型，最终的结果都保留小数部分。

* `x // y`

向下取整除法。python 2.x 3.x 中均能使用。总是会省略结果的小数部分，操作数是整数则返回整数，如果操作数有浮点数，则返回浮点数。<br>

`//`运算符有一个非正式的别名，截断除法。但其实更准确的说法是向下取整除法。它会向下舍入，而不是严格地截断，并且对负数也有效。对于正数，截断除法和向下取整除法是相同的，对于负数，除法操作是一个向下取整（除法总是向下取整，但对于正数，向下取整和截断总是相同的）。

```python
# python 3.x

5 / 2, 5 / -2
(2.5, -2.5)

5 // 2, 5 // -2
(2, -3)

5 / 2.0, 5 / -2.0
(2.5, -2.5)

5 // 2.0, 5 // -2.0
(2.0, -3.0)
```

```python
# python 2.x

5 / 2, 5 / -2
(2, -3)

5 // 2, 5 // -2
(2, -3)

5 / 2.0, 5 / -2.0
(2.5, -2.5)

5 // 2.0, 5 // -2.0
(2.0, -3.0)
```

如果你想获得趋向于零的截断，不管正负，那么总是将浮点数整除法结果传入 `math.trunc()` 函数即可。

```python
# python 3.x
import math

5 // -2
-3

math.trunc(5 // -2)
-2
```

```python
# python 2.x
import math

5 // -2
-3

math.trunc(5 // -2)
-2
```
### 十六进制 八进制 二进制

在内存中，不同进制的数字字面量是等价的：

```python
0o1, 0o20, 0o377
(1, 16, 255)

0x01, 0x10, 0xFF
(1, 16, 255)

0b1, 0b10000, 0b11111111
(1, 16, 255)
```

内置函数 `hex()` `oct()` `bin()` 能把整数转换成对应的进制的数字字符串：

```python
oct(64), hex(64), bin(64)
('0o100', '0x40', '0b1000000')
```

反过来，`int()` 能将一个数字的字符串转换成一个整数，有可选的第二个参数指定字符串数字的进制。

```python
int('0x40', 16), int('0b1000000', 2)
(64, 64)
```

### 其他内置数值工具

内置函数 `pow` 和 `abs` 用于计算幂和绝对值

```python
pow(2, 4), 2 ** 4
(16, 16)

abs(-42.0)
42.0
```

`sum` 对序列的项求和，`min` 和 `max` 求序列中最小和最大的值

```python
min(3, 1, 2, 4), max(3, 1, 2, 4)
(1, 4)
```

`math` 模块中有许多有用的函数

```python
import math

math.floor(2.567), math.floor(-2.567)
(2, -3)

math.trunc(2.567), math.trunc(-2.567)
(2, -2)

round(2.567), round(2.467), round(2.567, 2)
(3, 2, 2.57)
```

三种方式计算平方根：使用`math.sqrt()`，使用`pow()`，使用表达式

```python
import math

math.sqrt(144)
12.0

144 ** .5
12.0

pow(144, .5)
12.0
```

`random` 模块生成随机数，随即从序列中选取元素

```python
import random

random.random()
0.8564261637743298

random.randint(1, 10)
5

random.choice([1, 5, 7, 8])
1

a = [1, 5, 7, 8]
random.shuffle(a)
# [8, 7, 5, 1]
```

## 其他数值类型

### 小数类型

小数对象，`Decimal`，小数有固定的位数和小数点，因此，小数是精度固定的浮点数。

```python
0.1 + 0.1 + 0.1 - 0.3
5.551115123125783e-17

from decimal import Decimal
Decimal('0.1') + Decimal('0.1') + Decimal('0.1') - Decimal('0.3')
Decimal('0.0')
```

浮点数运算精度的缺失，如果换成小数对象，结果将变得准确。<br>

`decimal` 中的一个上下文对象可以指定精度（小数位数）和舍入模式（向上取整，向下取整）

```python
import decimal

decimal.Decimal(1) / decimal.Decimal(7)
Decimal('0.1428571428571428571428571429')

decimal.getcontext().prec = 4
decimal.Decimal(1) / decimal.Decimal(7)
Decimal('0.1429')

Decimal(0.1) + Decimal(0.1) + Decimal(0.1) - Decimal(0.3)
Decimal('1.110E-17')
```

### 分数类型

分数，`Fraction`

```python
from fractions import Fraction

x = Fraction(1, 3)
y = Fraction(4, 6)

x
Fraction(1, 3)

y
Fraction(2, 3)

print(y)
2/3

x + y
Fraction(1, 1)
x - y
Fraction(-1, 3)
x * y
Fraction(2, 9)
x / y
Fraction(1, 2)

Fraction(0.25)
Fraction(1, 4)
```
分数和浮点数可以互相转换

```python
from fractions import Fraction

f = 2.5
z = Fraction(*f.as_integer_ratio())
z
Fraction(5, 2)

x = Fraction(1, 3)

float(x)
0.3333333333333333

Fraction.from_float(1.75)
Fraction(7, 4)

Fraction.from_float(0.3333)
Fraction(6004199023210345, 18014398509481984)

Fraction.from_float(0.3333).limit_denominator(10)
Fraction(1, 3)
```
### 集合

集合，`set`，唯一的，不可变的对象的一个无序集合体。

#### python 2.6 及之前版本中的集合

```python
x = set('abcde')
y = set('bdxyz')

x
set(['b', 'e', 'c', 'a', 'd'])
y
set(['b', 'y', 'x', 'z', 'd'])

```

#### python 3.x 和 python 2.7 中的集合

```python
set([1, 2, 3, 4])
{1, 2, 3, 4}
# 使用内置函数 set 或者字面量形式创建集合

# 集合的一些基础操作
x = {'d', 'a', 'c', 'b', 'e'}
y = {'d', 'x', 'b', 'z', 'y'}

x - y # 差集
{'e', 'a', 'c'}

x | y # 并集
{'d', 'a', 'x', 'c', 'b', 'z', 'e', 'y'}

x & y # 交集
{'d', 'b'}

x ^ y # 对称差集
{'e', 'y', 'a', 'x', 'c', 'z'}

x > y, x < y # 检查x是否是y的真超集 检查x是否是y的真子集
(False, False)

'b' in x
True

x.add('k') # add 向集合中添加元素
{'d', 'e', 'a', 'k', 'c', 'b'}

x.remove('k') # remove 移除集合中的元素
{'d', 'e', 'a', 'c', 'b'}

x.update(y) # update 更新集合，添加y中所有元素到x中
{'d', 'a', 'x', 'c', 'b', 'z', 'e', 'y'}

x.union([3, 4]) # union 创建并集，并返回新的集合
{'d', 3, 4, 'a', 'x', 'c', 'b', 'z', 'e', 'y'}
```

注意，`{}` 在python中是字典，所以，空集合还是需要使用`set`函数创建，而不能使用字面量创建法。

#### 不可变限制 冻结集合

集合有一个限制：那就是集合只能包含`不可变`对象类型。因此，列表和字典不能加入到集合中，元组是可以的。集合自身也是可变的，所以不能将一个集合加入到另一个集合中，如果想这样做，需要调用内置函数`frozenset`，创建一个不可变的集合，这样就可以加入到其他集合中。

#### 集合推导

```python
{x ** 2 for x in [1, 2, 3, 4]}
{16, 1, 4, 9}
```

### 布尔型

`bool` 类型其实是整数类型的子类。`True` 和 `False` 是 `bool` 的实例。`True` 和 `False` 的行为和 `1` 还有 `0` 是一样的。